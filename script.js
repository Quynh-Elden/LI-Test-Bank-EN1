// --- GÃœVENLÄ°K AYARLARI ---
const GLOBAL_SITE_PASS = "Admin123"; 

// KullanÄ±cÄ± Listesi
const authorizedUsers = {
    "9999":   { name: "Nazan Koc",         pass: "AdminNazan" },
    "371687": { name: "Habib Targaryen",   pass: "Habib123" },
    "1001":   { name: "Test User",         pass: "1234" }
};
// ------------------------

let currentQuestions = [];
let currentUserInfo = ""; 

function checkLogin() {
    const siteInput = document.getElementById('sitePassInput').value.trim();
    const idInput = document.getElementById('userIdInput').value.trim();
    const passInput = document.getElementById('userPassInput').value.trim();
    
    const errorMsg = document.getElementById('error-msg');
    const welcomeMsg = document.getElementById('welcome-msg');
    
    // Kontroller
    if (siteInput !== GLOBAL_SITE_PASS) {
        showError("Global Site Access Code is wrong!");
        return;
    }
    if (!authorizedUsers[idInput]) {
        showError("User ID not found in database!");
        return;
    }
    if (authorizedUsers[idInput].pass !== passInput) {
        showError("Wrong personal password!");
        return;
    }

    // --- GÄ°RÄ°Åž BAÅžARILI ---
    const userName = authorizedUsers[idInput].name;
    currentUserInfo = `${userName} (ID: ${idInput})`;
    
    errorMsg.style.display = 'none';
    welcomeMsg.innerText = `Access Granted. Welcome, ${userName}!`;
    welcomeMsg.style.display = 'block';

    setTimeout(() => {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
        document.getElementById('user-display').innerText = `Logged in as: ${currentUserInfo}`;
    }, 1000);
}

function showError(message) {
    const errorMsg = document.getElementById('error-msg');
    errorMsg.innerText = message;
    errorMsg.style.display = 'block';
    
    const loginBox = document.getElementById('login-screen');
    loginBox.classList.add('shake');
    setTimeout(() => loginBox.classList.remove('shake'), 500);
}

function logout() {
    location.reload(); 
}

document.addEventListener("keypress", function(event) {
    if (event.key === "Enter") {
        if (document.getElementById('login-screen').style.display !== 'none') {
            checkLogin();
        }
    }
});

// --- SINAV SÄ°STEMÄ° ---

function generateExam(category) {
    const fileName = `questions-${category}.json`;

    fetch(fileName)
        .then(response => {
            if (!response.ok) throw new Error("File not found");
            return response.json();
        })
        .then(data => {
            const selectedQuestions = shuffleAndSelect(data, 7);
            displayExam(selectedQuestions);
        })
        .catch(error => console.error(error));
}

function shuffleAndSelect(array, count) {
    let shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled.slice(0, count);
}

function displayExam(questions) {
    const qBox = document.getElementById('questions-box');
    const aBox = document.getElementById('answers-box');
    const qSection = document.getElementById('questions-section');
    const aSection = document.getElementById('answers-section');

    qBox.textContent = "";
    aBox.textContent = "";

    let questionText = "";
    let answerText = "";

    questions.forEach((item, index) => {
        // GÃœNCELLEME BURADA: \n\n yerine sadece \n kullandÄ±k (Tek SatÄ±r BoÅŸluk)
        questionText += `${index + 1}) ${item.q}\n`;
        answerText += `${index + 1}) ${item.a}\n`;
    });

    qBox.textContent = questionText;
    aBox.textContent = answerText;

    qSection.style.display = 'block';
    aSection.style.display = 'none';
}

function showAnswers() {
    document.getElementById('answers-section').style.display = 'block';
    document.getElementById('answers-section').scrollIntoView({ behavior: 'smooth' });
}

// --- LOGLU KOPYALAMA ---
function copyToClipboard(elementId) {
    const content = document.getElementById(elementId).innerText;
    
    const now = new Date();
    // Tarih formatÄ±nÄ± daha net yapmak iÃ§in (GÃ¼n/Ay/YÄ±l)
    const timeString = now.toLocaleString('en-GB'); 
    
    let finalClip = "";
    
    if (elementId === 'questions-box') {
        finalClip = `ðŸ›‘ EXAM GENERATION LOG ðŸ›‘\nGenerated By: ${currentUserInfo}\nDate: ${timeString}\n----------------------------------\n\n${content}`;
    } else {
        finalClip = content;
    }

    navigator.clipboard.writeText(finalClip).then(() => {
        alert("Copied to clipboard with User Log!");
    }).catch(err => {
        console.error('Copy error:', err);
    });
}
